{"componentChunkName":"component---src-templates-post-template-tsx","path":"/2023-06-08/게시판 성능 개선하기 - 조회수 카운트에 대한 고민/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h3>[배경]</h3>\n<ul>\n<li>게시판 프로젝트 <a href=\"https://github.com/hsw0905/NPEC\" target=\"_blank\" rel=\"nofollow\">[링크]</a>를 진행하면서 500만개의 가데이터를 넣고 테스트를 돌려본 결과, 눈에 띄게 병목이 생기는 구간이 있었습니다. 바로 좋아요 개수를 증가시키는 부분이었는데요. 초기 boards(게시물 테이블) 설계에서는 게시물 테이블에 좋아요 개수 칼럼을 같이 가지고 있어서 <strong>사용자가 게시물을 볼 때마다 좋아요 개수를 업데이트하는 쿼리가 발생하고 있었습니다.</strong> 이런 방식이라면 사용자가 많아진다고 가정했을 때, 게시물 읽기에 많은 트래픽이 집중된다면 많은 업데이트 작업으로 인한 성능 저하가 예상되었습니다. 게시글 성격에 따라 충분히 발생할만한 이슈로 생각되었고, 이런 문제는 어떻게 처리하면 좋을지 궁금했습니다.</li>\n</ul>\n<h3>[문제]</h3>\n<ul>\n<li>하나의 게시물엔 사용자가 좋아요를 표시할 수 있고, 댓글을 작성할 수도 있습니다. 이렇게 되면 게시물을 읽을 때마다 좋아요 개수, 댓글 개수를 카운트 하기 위해 좋아요 테이블(board_likes), 댓글 테이블을 매번 조인해야 하는 상황이 발생하게 되는데요. 이 문제를 해결하기 위해 <strong>조회수 관련 칼럼들을 역정규화하여 별도의 테이블로 분리하였습니다.</strong> 왜냐하면 조회수 관련 칼럼은 각 게시물마다 유일하게 존재하며, 다른 테이블과 연결되는 관계도 없기 때문입니다. 따라서, 조회수 칼럼은 역정규화하여 중복을 허용하는 것이 가능하다고 판단하였습니다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e461d352f14093ead4be52f71668dfbd/d7258/boards.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.479166666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaklEQVR42o1Si46CQBDj/z/PS0QWBBEU5aEL+IJdqOkgxORyyW0yLkin7TwcfM44jhLW2uV5GAa559P3Pe73+3JXZYmmafB6veS96zo4bdsiTVNcLhfUdY08zxHHe1RVhdvthrIsBUhirTWUUsiybMGu1y6u16vkE+/wQxAEQsoEKnqeh+12i6IohJiO+t7g+XwiSRLBk4BErruB1rXk0qVDEBUPhwPolgK7XYTj8SjPTDLGwBgrpREXRZGIkdTzlDglThySkMlxHAsBHYZhiDSdBL4J6XTBai2uwjBCkqSCezweEyEVWSaV2DPl+9h4CtnphKLIP2RGBsNBcXDf9xzss8MfOqC6tUbCWCME/H8YpqS55HlYrIZuKcqq6FYcWkv28VdMazMFybuul+b7frBMmWVyQG3TyLsMZd65vwKYdpMVTBug4LquOGWsVj+I93tpFXvu4B9nLpnEdMVe0w2DJZ/PubSBi/0Gwtj+aSxdUWoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e461d352f14093ead4be52f71668dfbd/a59e9/boards.webp 192w,\n/static/e461d352f14093ead4be52f71668dfbd/0ca9f/boards.webp 384w,\n/static/e461d352f14093ead4be52f71668dfbd/dc9b9/boards.webp 768w,\n/static/e461d352f14093ead4be52f71668dfbd/0b371/boards.webp 966w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e461d352f14093ead4be52f71668dfbd/3b721/boards.png 192w,\n/static/e461d352f14093ead4be52f71668dfbd/66595/boards.png 384w,\n/static/e461d352f14093ead4be52f71668dfbd/fe486/boards.png 768w,\n/static/e461d352f14093ead4be52f71668dfbd/d7258/boards.png 966w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e461d352f14093ead4be52f71668dfbd/fe486/boards.png\"\n            alt=\"조회수 테이블 분리한 결과 - board_sorts Table\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3>[새로운 문제]</h3>\n<ul>\n<li>위와 같이 테이블을 나누었더니 게시물을 가져오면서 조회수 테이블만 참조하여 보여주면 되도록 개선하였습니다. 하지만 새로운 문제를 만나게 되었습니다. 예를 들어, 게시물 하나에 사용자가 좋아요 표시를 하게 된다면, 좋아요 테이블(board_likes)에 insert 작업이 생기면서 board_sorts 테이블에 like_count 값을 +1 증가시켜야 합니다. 이 두 작업은 같이 일어나야 했기 때문에 하나의 트랜잭션 안에 묶여 있었고, JPA의 Dirty-Checking으로 like_count 값이 업데이트 되는 구조였습니다. 만약에 좋아요를 업데이트 하는 트랜잭션 도중에 다른 누군가가 좋아요를 증감시킨다면, 경쟁 상태(Race-Condition)가 발생하여 데이터 정합성이 맞지 않을 수 있게 됩니다.</li>\n</ul>\n<h3>[해결 방법]</h3>\n<ol>\n<li><strong>Lock</strong></li>\n</ol>\n<ul>\n<li>쿼리에 락을 걸어 데이터 정합성을 맞출 수 있습니다. 하지만 이 방법은 조회 쿼리에 락을 걸게 되면 트랜잭션이 끝날 때까지 기다려야 하기 때문에, 성능이 나빠질 우려가 있었습니다.</li>\n</ul>\n<ol start=\"2\">\n<li><strong>Native Query</strong></li>\n</ol>\n<ul>\n<li>네이티브 쿼리를 이용해 board_sorts 테이블 자체의 카운트 값을 +1 시키는 방법입니다. 읽은 값을 바로 업데이트 하기 때문에 동시성 문제를 해결할 수 있습니다.</li>\n<li>하지만 조회수 관련 값은 빈번하게 변하는 값으로, 매번 업데이트를 하게 되면 서버에 무리가 갈 수 있다고 판단하였습니다.</li>\n</ul>\n<ol start=\"3\">\n<li><strong>Sync Schedule</strong></li>\n</ol>\n<ul>\n<li>@Scheduled를 이용하여 정합성을 맞추는 방법입니다. 즉, 특정 주기마다 조회수 관련 값을 맞춰 데이터 정합성을 지키게 합니다.</li>\n<li>이 방법은 업데이트 주기가 오기 전까지는 조회수 값이 맞지 않을 수 있습니다. 또한 여러 서버에서 스케쥴이 병렬적으로 발생하게 된다면 리소스가 낭비될 수 있습니다.</li>\n</ul>\n<ol start=\"4\">\n<li><strong>Event + Queue + @Scheduled</strong></li>\n</ol>\n<ul>\n<li>조회수에 변경이 일어나면 이벤트를 발생시켜 Queue에 넣게 됩니다. 그리고 Queue에 있는 이벤트를 @Scheduled를 이용해 처리하는 방법입니다.</li>\n<li>이 방법은 여러 서버에서 각각 하나의 Queue만 바라보고 있으며, 각 서버는 해당 Queue 하나의 이벤트만 처리하면 되기 때문에 Sync Schedule 방법보다 더 효율이 좋다고 판단했습니다.</li>\n</ul>\n<h3>[구현]</h3>\n<ol>\n<li>좋아요/취소가 발생하면 이벤트를 발행합니다(Publisher)</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BoardService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">BoardRepository</span> boardRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">BoardLikeRepository</span> boardLikeRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ApplicationEventPublisher</span> eventPublisher<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    \n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">likeBoard</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> boardId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> memberId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Member</span> findMember <span class=\"token operator\">=</span> <span class=\"token function\">findMember</span><span class=\"token punctuation\">(</span>memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Board</span> findBoard <span class=\"token operator\">=</span> <span class=\"token function\">findBoard</span><span class=\"token punctuation\">(</span>boardId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>boardLikeRepository<span class=\"token punctuation\">.</span><span class=\"token function\">existsByMemberIdAndBoardId</span><span class=\"token punctuation\">(</span>findMember<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> findBoard<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MemberAlreadyLikeBoardException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"이미 추천한 게시물 입니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        boardLikeRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BoardLike</span><span class=\"token punctuation\">(</span>findMember<span class=\"token punctuation\">,</span> findBoard<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token comment\">// boardId 전달(BoardLikeCreatedEvent)</span>\n        eventPublisher<span class=\"token punctuation\">.</span><span class=\"token function\">publishEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BoardLikeCreatedEvent</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>boardId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li>Event Handler에서 Queue에 이벤트를 담습니다.</li>\n</ol>\n<ul>\n<li>이벤트 Queue는 Redis의 Set을 사용했는데, 이유는 중복 이벤트 제거 효과로, 예를 들어 이벤트로 [좋아요, 취소, 좋아요]와 [취소, 좋아요, 좋아요]의 결과가 동일하게 좋아요 +1 상태이기 때문입니다.</li>\n<li>좋아요 테이블(board_likes)에 insert 작업을 본 작업, 이벤트 발행을 후 작업이라고 할 때, 본 작업이 성공해야만 후 작업이 진행되도록 @TransactionEventListener를 사용하였습니다. 기본값은 AFTER_COMMIT으로, 트랜잭션이 성공적으로 commit 되었을때만 이벤트를 실행합니다. 만일 후속 작업에서 이벤트 발행 중 오류가 발생한다면, 본 작업도 롤백됩니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BoardLikeEventHandler</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> redisTemplate<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ObjectMapper</span> mapper<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">BoardLikeEventHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> redisTemplate<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ObjectMapper</span> mapper<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>redisTemplate <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mapper <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@TransactionalEventListener</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">increaseBoardLikeCount</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BoardLikeCreatedEvent</span> event<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">JsonProcessingException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">SetOperations</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> setOps <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">BoardLikeModifiedMessage</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BoardLikeModifiedMessage</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span><span class=\"token function\">getBoardId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> jsonString <span class=\"token operator\">=</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">writeValueAsString</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        setOps<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"boardLike\"</span><span class=\"token punctuation\">,</span> jsonString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ol start=\"3\">\n<li>queue 에 있는 이벤트를 @Scheduled 로 주기적으로 실행합니다.</li>\n</ol>\n<ul>\n<li>좋아요 수를 count하여(board_likes 테이블) board_sorts 테이블을 업데이트합니다.</li>\n<li>Queue(Set)에 담긴 (중복 제거된) 이벤트 갯수만큼 count, update 쿼리가 발생하게 됩니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ScheduledService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> redisTemplate<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">BoardLikeCountSyncService</span> boardLikeCountSyncService<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ObjectMapper</span> mapper<span class=\"token punctuation\">;</span>\n\n   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token annotation punctuation\">@Scheduled</span><span class=\"token punctuation\">(</span>fixedDelay <span class=\"token operator\">=</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> boardLikeEvents <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"boardLike\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CollectionUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>boardLikeEvents<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BoardLikeModifiedMessage</span><span class=\"token punctuation\">></span></span> messages <span class=\"token operator\">=</span> <span class=\"token function\">convertMessageFromEvent</span><span class=\"token punctuation\">(</span>boardLikeEvents<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        boardLikeCountSyncService<span class=\"token punctuation\">.</span><span class=\"token function\">updateBoardSortsLikeCount</span><span class=\"token punctuation\">(</span>messages<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BoardLikeModifiedMessage</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">convertMessageFromEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> messages<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> messages<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>message <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">return</span> mapper<span class=\"token punctuation\">.</span><span class=\"token function\">readValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> message<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BoardLikeModifiedMessage</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">JsonProcessingException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"BoardLikeModifiedMessage.class 로 변환 에러. value: {}\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>결과적으로 매 업데이트마다 정확한 좋아요 개수를 계산할 수 있으며, 중복된 이벤트 제거도 가능하게 되었습니다.</li>\n</ul>\n<h3>[참고]</h3>\n<ul>\n<li><a href=\"https://velog.io/@znftm97/%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EA%B8%B0%EB%B0%98-%EC%84%9C%EB%B9%84%EC%8A%A4%EA%B0%84-%EA%B0%95%EA%B2%B0%ED%95%A9-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0-ApplicationEventPublisher#span-stylecolord9730d1-1-%EC%99%9C---%EA%B0%95%EA%B2%B0%ED%95%A9%EC%9C%BC%EB%A1%9C-%EC%9D%B8%ED%95%9C-%EB%AC%B8%EC%A0%9C%EB%93%A4span\" target=\"_blank\" rel=\"nofollow\">이벤트기반, 서비스간 강결합 문제 해결하기 - ApplicationEventPublisher</a></li>\n<li><a href=\"https://sokdak-sokdak.tistory.com/22\" target=\"_blank\" rel=\"nofollow\">속닥속닥 기술블로그 - 좋아요 개수 최적화하기</a></li>\n</ul>","frontmatter":{"title":"게시판 성능 개선하기 - 좋아요 개수","summary":"조회수 관련 정보를 별도 테이블로 분리하고 동시성 문제 해결하기","date":"2023.06.08.","categories":["Spring","NPEC Project"]}}}]}},"pageContext":{"slug":"/2023-06-08/게시판 성능 개선하기 - 조회수 카운트에 대한 고민/"}},"staticQueryHashes":[],"slicesMap":{}}